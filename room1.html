<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Roomify - Virtual Room Organizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont,
        "Roboto", sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: #e6f6ff;
      color: #222;
    }

    header {
      background: #ffffff;
      padding: 14px 28px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      z-index: 2;
    }

    header h1 {
      font-size: 22px;
      letter-spacing: 1px;
    }

    .scale-info {
      font-size: 13px;
      opacity: 0.8;
    }

    .main-layout {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    /* Left toolbar */
    #toolbar {
      width: 220px;
      background: #ccefff;
      border-right: 1px solid #a8ddf7;
      padding: 18px 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
    }

    #toolbar h2 {
      font-size: 16px;
      margin-bottom: 6px;
    }

    .tool-btn {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: none;
      text-align: left;
      cursor: pointer;
      background: #8dd2ff;
      color: #05496b;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
      transition: transform 0.1s ease, box-shadow 0.1s ease,
        background 0.1s ease;
    }

    .tool-btn span.label {
      flex: 1;
    }

    .tool-btn small {
      font-size: 11px;
      opacity: 0.85;
    }

    .tool-btn:hover {
      background: #7fcbff;
      transform: translateY(-1px);
      box-shadow: 0 3px 7px rgba(0, 0, 0, 0.2);
    }

    /* Right workspace */
    .workspace {
      flex: 1;
      padding: 14px 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow: hidden;
    }

    .room-wrapper {
      flex: 1;
      display: flex;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.25);
      background: #f9fdff;
    }

    /* Rulers */
    .ruler-top {
      height: 26px;
      display: flex;
      align-items: flex-end;
      padding-left: 40px;
      font-size: 11px;
      color: #555;
      gap: 0;
    }

    .ruler-top .tick {
      position: relative;
      text-align: center;
      border-left: 1px solid #b0c6d0;
      padding-top: 8px;
    }

    .ruler-top .tick span {
      position: relative;
      top: -2px;
    }

    .room-and-left {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    .ruler-left {
      width: 40px;
      border-right: 1px solid #b0c6d0;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      font-size: 11px;
      color: #555;
      padding-top: 0;
    }

    .ruler-left .tick {
      position: relative;
      width: 100%;
      border-top: 1px solid #b0c6d0;
      padding-right: 3px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    /* Room canvas */
    #room {
      position: relative;
      flex: 1;
      background-image: linear-gradient(
          to right,
          rgba(180, 205, 220, 0.4) 1px,
          transparent 1px
        ),
        linear-gradient(
          to bottom,
          rgba(180, 205, 220, 0.4) 1px,
          transparent 1px
        );
      background-size: 20px 20px; /* visual grid, not measurement */
      background-color: #ffffff;
      overflow: hidden;
    }

    #room-inner {
      position: absolute;
      top: 0;
      left: 0;
      border: 2px dashed #0078c9;
      background: repeating-linear-gradient(
          to right,
          rgba(0, 0, 0, 0.03) 0,
          rgba(0, 0, 0, 0.03) 1px,
          transparent 1px,
          transparent 10px
        ),
        repeating-linear-gradient(
          to bottom,
          rgba(0, 0, 0, 0.03) 0,
          rgba(0, 0, 0, 0.03) 1px,
          transparent 1px,
          transparent 10px
        );
    }

    .furniture {
      position: absolute;
      border-radius: 8px;
      background: #ffc56b;
      border: 2px solid #f59600;
      cursor: move;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      font-size: 11px;
      padding: 4px 6px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.25);
      user-select: none;
    }

    .furniture.selected {
      border-color: #0070ff;
      box-shadow: 0 0 0 2px rgba(0, 112, 255, 0.4);
    }

    .f-title {
      font-weight: 600;
      margin-bottom: 2px;
      font-size: 11px;
    }

    .f-size {
      font-size: 10px;
      opacity: 0.8;
    }

    /* Properties panel */
    #properties-panel {
      margin-top: 6px;
      padding: 8px 12px;
      border-radius: 12px;
      background: #ffffff;
      box-shadow: 0 2px 7px rgba(0, 0, 0, 0.18);
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
    }

    #properties-panel input {
      width: 60px;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #b0c6d0;
      font-size: 12px;
    }

    #properties-panel span.label {
      font-weight: 500;
    }

    footer {
      padding: 10px 18px 14px;
      font-size: 13px;
      text-align: center;
      background: #e6f6ff;
    }

    @media (max-width: 820px) {
      .main-layout {
        flex-direction: column;
      }
      #toolbar {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        max-height: 140px;
      }
      .workspace {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Roomify - Virtual Room Organizer</h1>
    <div class="scale-info" id="scale-info">Scale: 1 ft = 100 px</div>
  </header>

  <main class="main-layout">
    <!-- TOOLBAR -->
    <aside id="toolbar">
      <h2>Furniture</h2>
      <!-- data-w, data-h in feet (default size) -->
      <button class="tool-btn" data-name="Chair" data-w="2" data-h="2">
        <span class="label">Chair</span>
        <small>2×2 ft</small>
      </button>
      <button class="tool-btn" data-name="Table" data-w="3" data-h="3">
        <span class="label">Table</span>
        <small>3×3 ft</small>
      </button>
      <button class="tool-btn" data-name="Bed" data-w="6" data-h="3">
        <span class="label">Bed</span>
        <small>6×3 ft</small>
      </button>
      <button class="tool-btn" data-name="Sofa" data-w="5" data-h="3">
        <span class="label">Sofa</span>
        <small>5×3 ft</small>
      </button>
      <button class="tool-btn" data-name="Almari" data-w="4" data-h="2">
        <span class="label">Almari</span>
        <small>4×2 ft</small>
      </button>
      <button class="tool-btn" data-name="Bookshelf" data-w="3" data-h="1.5">
        <span class="label">Bookshelf</span>
        <small>3×1.5 ft</small>
      </button>
    </aside>

    <!-- WORKSPACE -->
    <section class="workspace">
      <div class="room-wrapper">
        <div class="ruler-left" id="ruler-left"></div>

        <div class="room-and-left">
          <div id="room">
            <div id="room-inner"></div>
          </div>
        </div>
      </div>

      <div class="ruler-top" id="ruler-top"></div>

      <!-- Furniture properties -->
      <div id="properties-panel">
        <span class="label">Selected:</span>
        <span id="selected-name">None</span>

        <span>| Width (ft):</span>
        <input type="number" id="prop-width" step="0.1" />

        <span>Height (ft):</span>
        <input type="number" id="prop-height" step="0.1" />
      </div>
    </section>
  </main>

  <footer>© 2025 Roomify, All Rights Reserved.</footer>

  <script>
    // --- CONFIG ---
    const SCALE = 10; // 1ft = 10px

    const room = document.getElementById("room");
    const roomInner = document.getElementById("room-inner");
    const rulerTop = document.getElementById("ruler-top");
    const rulerLeft = document.getElementById("ruler-left");
    const scaleInfo = document.getElementById("scale-info");

    const propertiesPanel = {
      name: document.getElementById("selected-name"),
      w: document.getElementById("prop-width"),
      h: document.getElementById("prop-height"),
    };

    scaleInfo.textContent = `Scale: 1 ft = ${SCALE} px`;

    // furniture state (in feet)
    const furnitureState = {}; // id -> { xFt, yFt, wFt, hFt, el, name }
    let nextId = 1;
    let selectedId = null;

    // dragging
    let draggingId = null;
    let dragOffsetPx = { x: 0, y: 0 };

    // --- INIT ROOM FROM localStorage ---
    function initRoomSize() {
      const widthFt =
        parseFloat(localStorage.getItem("roomWidthFt")) || 10;
      const heightFt =
        parseFloat(localStorage.getItem("roomHeightFt")) || 10;

      const widthPx = widthFt * SCALE;
      const heightPx = heightFt * SCALE;

      // roomInner is the actual "measured" room
      roomInner.style.width = widthPx + "px";
      roomInner.style.height = heightPx + "px";

      renderRulers(widthFt, heightFt);
    }

    function renderRulers(widthFt, heightFt) {
      rulerTop.innerHTML = "";
      rulerLeft.innerHTML = "";

      // top ruler
      const step = 1; // 1ft per tick
      for (let x = 0; x <= widthFt; x += step) {
        const tick = document.createElement("div");
        tick.className = "tick";
        tick.style.width = SCALE * step + "px";
        tick.innerHTML = `<span>${x}ft</span>`;
        rulerTop.appendChild(tick);
      }

      // left ruler
      for (let y = 0; y <= heightFt; y += step) {
        const tick = document.createElement("div");
        tick.className = "tick";
        tick.style.height = SCALE * step + "px";
        tick.innerHTML = `<span>${y}ft</span>`;
        rulerLeft.appendChild(tick);
      }
    }

    // --- FURNITURE HELPERS ---
    function applyFurnitureStyle(id) {
      const f = furnitureState[id];
      const el = f.el;
      const wPx = f.wFt * SCALE;
      const hPx = f.hFt * SCALE;
      const xPx = f.xFt * SCALE;
      const yPx = f.yFt * SCALE;

      el.style.width = wPx + "px";
      el.style.height = hPx + "px";
      el.style.left = xPx + "px";
      el.style.top = yPx + "px";

      const sizeLabel = el.querySelector(".f-size");
      sizeLabel.textContent = `${f.wFt.toFixed(2)}×${f.hFt.toFixed(2)} ft`;
    }

    function rectanglesOverlap(a, b) {
      return !(
        a.xFt + a.wFt <= b.xFt ||
        b.xFt + b.wFt <= a.xFt ||
        a.yFt + a.hFt <= b.yFt ||
        b.yFt + b.hFt <= a.yFt
      );
    }

    function canPlaceFurniture(id, newXFt, newYFt, newWFt, newHFt) {
      const widthFt =
        parseFloat(localStorage.getItem("roomWidthFt")) || 10;
      const heightFt =
        parseFloat(localStorage.getItem("roomHeightFt")) || 10;

      if (
        newXFt < 0 ||
        newYFt < 0 ||
        newXFt + newWFt > widthFt ||
        newYFt + newHFt > heightFt
      ) {
        return false;
      }

      const newRect = { xFt: newXFt, yFt: newYFt, wFt: newWFt, hFt: newHFt };

      for (const otherId in furnitureState) {
        if (otherId === id) continue;
        const o = furnitureState[otherId];
        const otherRect = {
          xFt: o.xFt,
          yFt: o.yFt,
          wFt: o.wFt,
          hFt: o.hFt,
        };
        if (rectanglesOverlap(newRect, otherRect)) return false;
      }
      return true;
    }

    function tryMoveFurniture(id, newXPx, newYPx) {
      const item = furnitureState[id];
      const newXFt = newXPx / SCALE;
      const newYFt = newYPx / SCALE;

      if (canPlaceFurniture(id, newXFt, newYFt, item.wFt, item.hFt)) {
        item.xFt = newXFt;
        item.yFt = newYFt;
        applyFurnitureStyle(id);
      } else {
        // revert visual
        applyFurnitureStyle(id);
      }
    }

    function tryResizeFurniture(id, newWFt, newHFt) {
      const item = furnitureState[id];

      if (newWFt <= 0 || newHFt <= 0) return;

      if (canPlaceFurniture(id, item.xFt, item.yFt, newWFt, newHFt)) {
        item.wFt = newWFt;
        item.hFt = newHFt;
        applyFurnitureStyle(id);
      } else {
        // keep old values in input
        propertiesPanel.w.value = item.wFt.toFixed(2);
        propertiesPanel.h.value = item.hFt.toFixed(2);
      }
    }

    function setSelected(id) {
      if (selectedId && furnitureState[selectedId]) {
        furnitureState[selectedId].el.classList.remove("selected");
      }
      selectedId = id;

      if (!id) {
        propertiesPanel.name.textContent = "None";
        propertiesPanel.w.value = "";
        propertiesPanel.h.value = "";
        return;
      }

      const f = furnitureState[id];
      f.el.classList.add("selected");
      propertiesPanel.name.textContent = f.name;
      propertiesPanel.w.value = f.wFt.toFixed(2);
      propertiesPanel.h.value = f.hFt.toFixed(2);
    }

    function addFurniture(name, defaultWFt, defaultHFt) {
      const id = "f" + nextId++;
      const el = document.createElement("div");
      el.className = "furniture";
      el.dataset.id = id;
      el.innerHTML = `
        <div class="f-title">${name}</div>
        <div class="f-size"></div>
      `;

      roomInner.appendChild(el);

      // find initial non-overlapping position (scan from 0,0)
      let placed = false;
      let xFt = 0;
      let yFt = 0;
      const widthFt =
        parseFloat(localStorage.getItem("roomWidthFt")) || 10;
      const heightFt =
        parseFloat(localStorage.getItem("roomHeightFt")) || 10;

      for (let yy = 0; yy + defaultHFt <= heightFt && !placed; yy += 0.5) {
        for (let xx = 0; xx + defaultWFt <= widthFt && !placed; xx += 0.5) {
          if (canPlaceFurniture(id, xx, yy, defaultWFt, defaultHFt)) {
            xFt = xx;
            yFt = yy;
            placed = true;
          }
        }
      }

      furnitureState[id] = {
        xFt,
        yFt,
        wFt: defaultWFt,
        hFt: defaultHFt,
        el,
        name,
      };
      applyFurnitureStyle(id);
      setSelected(id);
    }

    // --- EVENT LISTENERS ---

    // toolbar buttons → add furniture
    document.querySelectorAll(".tool-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        const name = btn.dataset.name;
        const wFt = parseFloat(btn.dataset.w);
        const hFt = parseFloat(btn.dataset.h);
        addFurniture(name, wFt, hFt);
      });
    });

    // select & drag furniture
    roomInner.addEventListener("mousedown", (e) => {
      const target = e.target.closest(".furniture");
      if (!target) return;

      const id = target.dataset.id;
      setSelected(id);

      draggingId = id;

      const rect = target.getBoundingClientRect();
      dragOffsetPx.x = e.clientX - rect.left;
      dragOffsetPx.y = e.clientY - rect.top;

      e.preventDefault();
    });

    document.addEventListener("mousemove", (e) => {
      if (!draggingId) return;

      const item = furnitureState[draggingId];
      const parentRect = roomInner.getBoundingClientRect();

      let newXPx = e.clientX - parentRect.left - dragOffsetPx.x;
      let newYPx = e.clientY - parentRect.top - dragOffsetPx.y;

      tryMoveFurniture(draggingId, newXPx, newYPx);
    });

    document.addEventListener("mouseup", () => {
      draggingId = null;
    });

    // click on empty space → deselect
    roomInner.addEventListener("click", (e) => {
      if (!e.target.closest(".furniture")) {
        setSelected(null);
      }
    });

    // resize via properties panel
    propertiesPanel.w.addEventListener("change", () => {
      if (!selectedId) return;
      const val = parseFloat(propertiesPanel.w.value);
      if (!isNaN(val)) {
        tryResizeFurniture(selectedId, val, furnitureState[selectedId].hFt);
      }
    });

    propertiesPanel.h.addEventListener("change", () => {
      if (!selectedId) return;
      const val = parseFloat(propertiesPanel.h.value);
      if (!isNaN(val)) {
        tryResizeFurniture(selectedId, furnitureState[selectedId].wFt, val);
      }
    });

    // --- START ---
    initRoomSize();
  </script>
</body>
</html>
